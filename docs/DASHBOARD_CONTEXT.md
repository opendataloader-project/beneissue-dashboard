# Beneissue 메트릭 대시보드

## 개요

AI 이슈 자동화 성능을 측정하고 시각화하는 웹 대시보드

**목적:**

- 투자자/파트너에게 AI 자동화 성과 증명
- 팩트 기반 지표로 신뢰성 확보
- 내부 성능 모니터링

---

## 아키텍처

```
[GitHub Actions]
       │
       ▼
[beneissue Python] ──POST──▶ [Supabase PostgreSQL]
                                      │
                              ◀──SELECT──
                                      │
                              [Next.js + Vercel]
                              (API Routes = 비즈니스 로직)
                                      │
                                      ▼
                        beneissue.opendataloader.org
```

**핵심 설계:**

- Python → Supabase 직접 쓰기 (service_key)
- Next.js → Supabase 읽기 전용 (anon_key)
- 별도 백엔드 서버 불필요 (서버리스)
- `workflow_runs` 테이블 하나로 모든 지표 계산

---

## 기술 스택

| 항목       | 선택                              |
| ---------- | --------------------------------- |
| 프론트엔드 | Next.js 16 + shadcn/ui + Recharts |
| 상태관리   | Jotai                             |
| DB         | Supabase PostgreSQL               |
| 호스팅     | Vercel (무료)                     |
| 스타일링   | Tailwind CSS v4                   |
| i18n       | 커스텀 훅 (ko/en)                 |

---

## 용어 정의

| 용어          | 의미                | 조건                                                                                                                   |
| ------------- | ------------------- | ---------------------------------------------------------------------------------------------------------------------- |
| **자동 해결** | 인간 개입 없이 종료 | `triage_decision IN ('invalid', 'duplicate', 'needs_info')` OR `fix_success = true` OR `fix_decision = 'comment_only'` |
| **수동 필요** | 인간 개입 필요      | 위 조건에 해당하지 않는 케이스                                                                                         |

### 자동 해결 케이스 상세

- `triage/invalid` - 유효하지 않은 이슈
- `triage/duplicate` - 중복 이슈
- `triage/needs-info` - 정보 요청 후 대기
- `fix/completed` - PR 자동 생성 완료
- `fix/comment-only` - 코멘트로 해결 (코드 변경 불필요)

---

## 메트릭 정의 (유니크 이슈 기준)

**유니크 이슈**: 동일 `(repo, issue_number)` 조합은 1건으로 카운트

| 지표           | 정의                                             | SQL 개념                                                |
| -------------- | ------------------------------------------------ | ------------------------------------------------------- |
| 총 처리량      | 유니크 이슈 수                                   | `COUNT(DISTINCT (repo, issue_number))`                  |
| 자동 해결율    | 자동 해결된 유니크 이슈 / 전체 유니크 이슈 × 100 | 조건 필터 후 DISTINCT                                   |
| 평균 응답 시간 | 유니크 이슈별 첫 응답 시간의 평균                | `MIN(workflow_started_at) - issue_created_at` per issue |
| 총 AI 비용     | 모든 레코드의 비용 합계                          | `SUM(input_cost + output_cost)`                         |
| 건당 AI 비용   | 총 AI 비용 / 유니크 이슈 수                      | 위 두 값 나누기                                         |

### SQL 예시

```sql
-- 1. 총 처리량 (유니크 이슈)
SELECT COUNT(DISTINCT (repo, issue_number)) FROM workflow_runs;

-- 2. 자동 해결된 유니크 이슈
SELECT COUNT(DISTINCT (repo, issue_number))
FROM workflow_runs
WHERE triage_decision IN ('invalid', 'duplicate', 'needs_info')
   OR fix_success = true
   OR fix_decision = 'comment_only';

-- 3. 평균 응답 시간 (유니크 이슈별 첫 응답)
SELECT AVG(first_response_seconds) FROM (
    SELECT EXTRACT(EPOCH FROM (MIN(workflow_started_at) - MIN(issue_created_at))) as first_response_seconds
    FROM workflow_runs
    WHERE issue_created_at IS NOT NULL
    GROUP BY repo, issue_number
) t;

-- 4. 총 AI 비용
SELECT SUM(input_cost + output_cost) FROM workflow_runs;
```

---

## 대시보드 페이지

| 경로         | 용도                                                   | 상태      |
| ------------ | ------------------------------------------------------ | --------- |
| `/`          | Public Stats - 히어로 섹션 + 핵심 지표 4개 + 추이 차트 | 구현 예정 |
| `/dashboard` | 통합 대시보드 - KPI 카드 + 추이 차트 + 결과 분포       | 구현 예정 |

---

## 기간 필터

| 옵션        | 설명          |
| ----------- | ------------- |
| 1주         | 최근 7일      |
| 1달         | 최근 30일     |
| 90일        | 최근 90일     |
| 1년         | 최근 365일    |
| 전체        | 모든 데이터   |
| 사용자 지정 | 시작일~종료일 |

---

## 차트 구성

### 1. 처리량 추이 차트 (Stacked Bar + Line)

```
│ 100%                              ●────● 자동해결율 (선, 우측 Y축)
│                          ●────●
│      ●────●────●────●
│  ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐
│  │░│ │░│ │░│ │░│ │░│ │░│  ░ 수동 필요
│  │█│ │█│ │█│ │█│ │█│ │█│  █ 자동 해결
│  └─┘ └─┘ └─┘ └─┘ └─┘ └─┘
└──────────────────────────────
   1월  2월  3월  4월  5월  6월
```

- **막대 (Stacked Bar)**: 자동 해결 + 수동 필요 = 총 처리량
- **선 (Line)**: 자동해결율 (%)
- 기간 필터에 따라 일별/월별 자동 조정

### 2. 비용 추이 차트 (Stacked Bar)

```
│ $50
│  ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐ ┌─┐
│  │▓│ │▓│ │▓│ │▓│ │▓│ │▓│  ▓ Output Cost
│  │█│ │█│ │█│ │█│ │█│ │█│  █ Input Cost
│  └─┘ └─┘ └─┘ └─┘ └─┘ └─┘
└──────────────────────────────
   1월  2월  3월  4월  5월  6월
```

- **하단 막대**: `input_cost` (Input tokens 비용)
- **상단 막대**: `output_cost` (Output tokens 비용)
- **툴팁**: Input: $X.XX, Output: $Y.YY, Total: $Z.ZZ
- 기간 필터에 따라 일별/월별 자동 조정

### 3. 결과 분포 (2분류 바)

```
┌─────────────────────────────┐
│  ██████████████░░░░  72%   │  자동 해결
│  ░░░░░░░░░░░░░░████  28%   │  수동 필요
└─────────────────────────────┘
```

투자자 메시지: "72%는 사람 개입 없이 처리됨"

---

## 와이어프레임

### Public Stats (/)

```
┌─────────────────────────────────────────────────────────────┐
│  [Header: Logo | Dashboard | Lang]                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│              ● Live Metrics                                 │
│                                                             │
│           AI Issue Automation                               │
│           Performance at a Glance                           │
│                                                             │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐       │
│  │   47     │ │   72%    │ │   45초   │ │  $0.32   │       │
│  │ 총 처리량 │ │ 자동해결율│ │ 평균응답  │ │ 건당비용  │       │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘       │
│                                                             │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ 월별 추이 차트 (Stacked Bar + Line)                          ││
│  └─────────────────────────────────────────────────────────┘│
│                                                             │
│  [Footer]                                                   │
└─────────────────────────────────────────────────────────────┘
```

### Dashboard (/dashboard)

```
┌─────────────────────────────────────────────────────────────────────────┐
│  [Header]                                                               │
├─────────────────────────────────────────────────────────────────────────┤
│  Executive Dashboard                    [1주|1달|90일|1년|전체|지정]    │
│  팩트 기반 AI 성능 지표                                                  │
├─────────────────────────────────────────────────────────────────────────┤
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌────────────────┐             │
│  │   47     │ │   72%    │ │   45초   │ │  $15.04        │             │
│  │ 총 처리량 │ │ 자동해결율│ │ 평균응답  │ │ 총 AI비용      │             │
│  │ ▲+12    │ │ ▲+5%    │ │ ▼-8초   │ │ (건당 $0.32)   │             │
│  └──────────┘ └──────────┘ └──────────┘ └────────────────┘             │
│                                                                         │
│  ┌─────────────────────────────┬───────────────────────────────────────┤
│  │ 처리량 추이                  │ 비용 추이                             │
│  │ (Stacked Bar + Line)        │ (Stacked Bar)                         │
│  │                             │                                       │
│  │  ┌─┐ ┌─┐ ┌─┐ ┌─┐  ●──● 율  │  ┌─┐ ┌─┐ ┌─┐ ┌─┐                     │
│  │  │░│ │░│ │░│ │░│  ░ 수동   │  │▓│ │▓│ │▓│ │▓│  ▓ Output Cost      │
│  │  │█│ │█│ │█│ │█│  █ 자동   │  │█│ │█│ │█│ │█│  █ Input Cost       │
│  │  └─┘ └─┘ └─┘ └─┘           │  └─┘ └─┘ └─┘ └─┘                     │
│  └─────────────────────────────┴───────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐│
│  │ 결과 분포                                                            ││
│  │ ┌───────────────────────────────────────────────────────────────┐  ││
│  │ │  ██████████████████████░░░░░░░░  72%  자동 해결               │  ││
│  │ │  ░░░░░░░░░░░░░░░░░░░░░░████████  28%  수동 필요               │  ││
│  │ └───────────────────────────────────────────────────────────────┘  ││
│  └─────────────────────────────────────────────────────────────────────┘│
│                                                                         │
│  [Footer]                                                               │
└─────────────────────────────────────────────────────────────────────────┘
```
